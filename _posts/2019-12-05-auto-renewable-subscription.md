---
date: 2019-12-05 03:20:42
layout: post
title: "Auto Renewable Subscription"
subtitle:
description:
image:
optimized_image:
category:
tags:
author:
paginate: false
---

- [ ] iOS 튜토리얼 페이지 이미지 바꿔야함
- [ ] 구독상태일 경우 로그인 할때 purchase_token으로 original_transaction_id를 보낸다
- [ ] 구독상태가 아닐 경우 로그인 할때 purchase_token으로 null 를 보낸다.
- [ ] 구독 상태가 아닌 경우 구독 취소버튼만 GONE 처리한다.
- [ ] 구독 복원하기를 하면 구독을 상태 여부를 확인 한 후 UserDefault를 업데이트 한다.
- [x] Appdelegate 에서 구독 상태를 앱 초기 시작시 확인한다
- [x] receipt 파싱한다
- [x] receipt 에서 제일 최근의 expires_date를 가져온다
- [x] 오늘 날짜랑 비교하여 구독 상태 여부를 확인한다.
- [x] 만약 Userdefaul에서 구독 상태인 경우 구독하기 버튼, 구독 복원하기 버튼은 GONE 처리한다
- [x] 서비스 구독 창은 Userdefaul를 참고하여 초기화면이 세팅된다.
- [x] 신규 구독을 하면 구독결제가 진행되고 UserDefault를 업데이트 하고 UI 를 바꾼다


- [ ]  서버에 구독 상태 보내는것 해야함
- [ ] 구독 복원하기 구현해야함
- [ ] 구독 상태별 기능 제한 해야함
- [ ] 무료버전일때 광고 붙여야함
- [ ] 앱스토어 구독 상품 정보 확인 받아야함

안드로이드는 playstore에 저장된 아이디를 쓰기 때문에 복원이 필요가 없다



1. 앱을 지웠다 깔면 receipt-data는 바껴있음
2. original_transaction_id 는 동일함
3. 구독 복원하기가 이상함 무조건 복원됨
    1. 구독 복원을 하면 detail data 가 오는데 original transaction 을 가지고 비교를 해야겠음
    2. original transaction 중 가장 최근것의 expire_date를 가져와 현재 날짜와 비교
    3. 비교하여 구독 기간 이내면 구독 복원
    4. 구독 기간내가 아니면 구독 상태 아니라고 띄움

[테스트]
1. 처음 깔고 구독했을 때
2. 구독 상태에서 다시 구독할때
3. 구독 상태에서 구독 복원 할때
4. 미 구독 상태에서 구독 복원 할때



   정기구독 주의사항 - 결제는 구매 시 iTunes 계정으로 진행됩니다. - iTunes 계정설정에서 언제든지 정기구독을 취소할 수 있습니다. -  정기 구독 취소를 하더라도, 다음 갱신 시점까진 구독이 유효하며 정상적으로 서비스 이용이 가능합니다. - 정기 구독 주기가 끝나기 24시간 내에 다음 구독 갱신에 대한 비용 확인 및 청구가 진행됩니다.  - 회원 탈퇴 혹은 앱을 삭제해도 iTunes 구독이 별도로 취소되지 않으니 iTunes 계정 설정에서 구독을 취소해야 합니다. - 남은 무료 체험 기간 중 이용권을 유료 구매하는 경우 남은 기간이 환불되거나 이월되지 않습니다. - 정기 구독 주기가 끝나기 최소 24시간 전에 취소 상태가 아니라면 구독 갱신 결제가 진행됩니다. - iOS 결제 관련 문의(중복구매 처리, 환불, 이용권 미지급 등)는 애플 고객센터로 문의하셔야 처리가 가능합니다. 기본적으로 구독 중 남은 기간에 대한 환불은 가능하지 않습니다.

